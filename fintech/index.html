<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>FinTech - Controle Financeiro</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üí∞</text></svg>">
    <style>
        /* ==========================================
           CSS VARIABLES - DESIGN SYSTEM
           ========================================== */
        :root {
            /* Cores principais */
            --primary: #667eea;
            --primary-dark: #5a67d8;
            --primary-light: #a3bffa;

            /* Status */
            --success: #48bb78;
            --success-light: #c6f6d5;
            --warning: #ed8936;
            --warning-light: #feebc8;
            --danger: #f56565;
            --danger-light: #fed7d7;

            /* Neutros */
            --white: #ffffff;
            --gray-50: #f7fafc;
            --gray-100: #edf2f7;
            --gray-200: #e2e8f0;
            --gray-300: #cbd5e0;
            --gray-400: #a0aec0;
            --gray-500: #718096;
            --gray-600: #4a5568;
            --gray-700: #2d3748;
            --gray-800: #1a202c;

            /* Gradientes */
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-success: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            --gradient-warning: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
            --gradient-danger: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);

            /* Sombras */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);

            /* Espa√ßamento */
            --spacing-xs: 4px;
            --spacing-sm: 8px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --spacing-xl: 32px;

            /* Bordas */
            --radius-sm: 6px;
            --radius-md: 10px;
            --radius-lg: 16px;
            --radius-full: 9999px;

            /* Transi√ß√µes */
            --transition: all 0.2s ease;

            /* Sidebar */
            --sidebar-width: 280px;
        }

        /* ==========================================
           RESET & BASE
           ========================================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 16px;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--gray-100);
            color: var(--gray-700);
            line-height: 1.5;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* ==========================================
           LAYOUT - MOBILE FIRST
           ========================================== */
        .app {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            left: -100%;
            top: 0;
            width: 100%;
            max-width: var(--sidebar-width);
            height: 100vh;
            background: var(--white);
            z-index: 1000;
            transition: left 0.3s ease;
            box-shadow: var(--shadow-lg);
            display: flex;
            flex-direction: column;
        }

        .sidebar.open {
            left: 0;
        }

        .sidebar-header {
            padding: var(--spacing-lg);
            background: var(--gradient-primary);
            color: var(--white);
        }

        .sidebar-header h1 {
            font-size: 1.25rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .sidebar-nav {
            flex: 1;
            padding: var(--spacing-md);
            overflow-y: auto;
        }

        .nav-section {
            margin-bottom: var(--spacing-lg);
        }

        .nav-section-title {
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--gray-400);
            padding: var(--spacing-sm) var(--spacing-md);
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-md);
            border-radius: var(--radius-md);
            color: var(--gray-600);
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
            cursor: pointer;
        }

        .nav-item:hover {
            background: var(--gray-100);
            color: var(--primary);
        }

        .nav-item.active {
            background: var(--primary-light);
            color: var(--primary-dark);
        }

        .nav-item .icon {
            font-size: 1.25rem;
        }

        /* Overlay */
        .sidebar-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .sidebar-overlay.visible {
            opacity: 1;
            visibility: visible;
        }

        /* Main Content */
        .main {
            flex: 1;
            min-height: 100vh;
            padding-bottom: 80px; /* Espa√ßo para bottom nav */
        }

        /* Header Mobile */
        .header-mobile {
            position: sticky;
            top: 0;
            z-index: 100;
            background: var(--gradient-primary);
            color: var(--white);
            padding: var(--spacing-md);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header-mobile h1 {
            font-size: 1rem;
            font-weight: 600;
        }

        .menu-toggle {
            background: rgba(255,255,255,0.2);
            border: none;
            color: var(--white);
            width: 40px;
            height: 40px;
            border-radius: var(--radius-md);
            font-size: 1.25rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Bottom Navigation Mobile */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--white);
            border-top: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-around;
            padding: var(--spacing-sm) 0;
            z-index: 100;
        }

        .bottom-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
            padding: var(--spacing-sm);
            color: var(--gray-500);
            text-decoration: none;
            font-size: 0.65rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }

        .bottom-nav-item .icon {
            font-size: 1.25rem;
        }

        .bottom-nav-item.active {
            color: var(--primary);
        }

        /* Content Area */
        .content {
            padding: var(--spacing-md);
        }

        /* ==========================================
           CARDS
           ========================================== */
        .card {
            background: var(--white);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow);
            margin-bottom: var(--spacing-md);
            overflow: hidden;
        }

        .card-header {
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--gray-100);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .card-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--gray-700);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .card-body {
            padding: var(--spacing-md);
        }

        /* ==========================================
           HERO CARD - CAPITAL DE GIRO
           ========================================== */
        .hero-card {
            background: var(--gradient-primary);
            color: var(--white);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-md);
        }

        .hero-card.warning {
            background: var(--gradient-warning);
        }

        .hero-card.danger {
            background: var(--gradient-danger);
        }

        .hero-card.success {
            background: var(--gradient-success);
        }

        .hero-label {
            font-size: 0.75rem;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: var(--spacing-xs);
        }

        .hero-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: var(--spacing-md);
        }

        .hero-metrics {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--spacing-md);
        }

        .hero-metric {
            background: rgba(255,255,255,0.15);
            padding: var(--spacing-md);
            border-radius: var(--radius-md);
        }

        .hero-metric-label {
            font-size: 0.7rem;
            opacity: 0.9;
        }

        .hero-metric-value {
            font-size: 1.1rem;
            font-weight: 600;
        }

        /* ==========================================
           ONBOARDING / GUIA
           ========================================== */
        .onboarding {
            background: var(--white);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-md);
            border-left: 4px solid var(--primary);
        }

        .onboarding-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: var(--spacing-sm);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .onboarding-text {
            font-size: 0.875rem;
            color: var(--gray-600);
            margin-bottom: var(--spacing-md);
        }

        .onboarding-steps {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        .onboarding-step {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-sm);
            background: var(--gray-50);
            border-radius: var(--radius-sm);
            font-size: 0.875rem;
        }

        .onboarding-step.completed {
            background: var(--success-light);
            color: var(--success);
        }

        .onboarding-step .step-number {
            width: 24px;
            height: 24px;
            border-radius: var(--radius-full);
            background: var(--primary);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .onboarding-step.completed .step-number {
            background: var(--success);
        }

        /* ==========================================
           FORMS
           ========================================== */
        .form-group {
            margin-bottom: var(--spacing-md);
        }

        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--gray-600);
            margin-bottom: var(--spacing-xs);
        }

        .form-hint {
            font-size: 0.75rem;
            color: var(--gray-400);
            margin-top: var(--spacing-xs);
        }

        .form-input,
        .form-select {
            width: 100%;
            padding: var(--spacing-md);
            border: 1px solid var(--gray-300);
            border-radius: var(--radius-md);
            font-size: 1rem;
            color: var(--gray-700);
            background: var(--white);
            transition: var(--transition);
        }

        .form-input:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-input::placeholder {
            color: var(--gray-400);
        }

        /* Input com prefixo R$ */
        .input-money {
            position: relative;
        }

        .input-money::before {
            content: 'R$';
            position: absolute;
            left: var(--spacing-md);
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-400);
            font-weight: 500;
        }

        .input-money .form-input {
            padding-left: 40px;
        }

        /* ==========================================
           BUTTONS
           ========================================== */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-md) var(--spacing-lg);
            border: none;
            border-radius: var(--radius-md);
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
        }

        .btn-primary {
            background: var(--primary);
            color: var(--white);
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-success {
            background: var(--success);
            color: var(--white);
        }

        .btn-danger {
            background: var(--danger);
            color: var(--white);
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--gray-300);
            color: var(--gray-600);
        }

        .btn-outline:hover {
            background: var(--gray-100);
        }

        .btn-block {
            width: 100%;
        }

        .btn-sm {
            padding: var(--spacing-sm) var(--spacing-md);
            font-size: 0.75rem;
        }

        /* ==========================================
           ALERTS
           ========================================== */
        .alert {
            padding: var(--spacing-md);
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-md);
            font-size: 0.875rem;
            display: flex;
            align-items: flex-start;
            gap: var(--spacing-sm);
        }

        .alert-success {
            background: var(--success-light);
            color: #276749;
            border-left: 4px solid var(--success);
        }

        .alert-warning {
            background: var(--warning-light);
            color: #975a16;
            border-left: 4px solid var(--warning);
        }

        .alert-danger {
            background: var(--danger-light);
            color: #c53030;
            border-left: 4px solid var(--danger);
            animation: pulse-danger 2s infinite;
        }

        @keyframes pulse-danger {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        /* ==========================================
           TRANSACTION LIST
           ========================================== */
        .transaction-list {
            display: flex;
            flex-direction: column;
        }

        .transaction-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--gray-100);
        }

        .transaction-item:last-child {
            border-bottom: none;
        }

        .transaction-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            flex-shrink: 0;
        }

        .transaction-icon.income {
            background: var(--success-light);
        }

        .transaction-icon.expense {
            background: var(--danger-light);
        }

        .transaction-icon.fuel {
            background: var(--warning-light);
        }

        .transaction-details {
            flex: 1;
            min-width: 0;
        }

        .transaction-title {
            font-weight: 500;
            color: var(--gray-700);
            font-size: 0.875rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .transaction-subtitle {
            font-size: 0.75rem;
            color: var(--gray-400);
        }

        .transaction-amount {
            font-weight: 600;
            font-size: 0.875rem;
            text-align: right;
        }

        .transaction-amount.income {
            color: var(--success);
        }

        .transaction-amount.expense {
            color: var(--danger);
        }

        .transaction-actions {
            display: flex;
            gap: var(--spacing-xs);
        }

        /* ==========================================
           WEEKLY CONTROL
           ========================================== */
        .week-summary {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
        }

        .week-stat {
            background: var(--gray-50);
            padding: var(--spacing-md);
            border-radius: var(--radius-md);
            text-align: center;
        }

        .week-stat-label {
            font-size: 0.7rem;
            color: var(--gray-500);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .week-stat-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--gray-700);
            margin-top: var(--spacing-xs);
        }

        .week-stat-value.income { color: var(--success); }
        .week-stat-value.expense { color: var(--danger); }

        .distribution-bar {
            display: flex;
            height: 8px;
            border-radius: var(--radius-full);
            overflow: hidden;
            margin-bottom: var(--spacing-md);
        }

        .distribution-segment {
            transition: var(--transition);
        }

        .distribution-legend {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-md);
            font-size: 0.75rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }

        /* ==========================================
           TABS
           ========================================== */
        .tabs {
            display: flex;
            gap: var(--spacing-sm);
            padding: var(--spacing-sm);
            background: var(--gray-100);
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-md);
            overflow-x: auto;
        }

        .tab {
            flex: 1;
            padding: var(--spacing-sm) var(--spacing-md);
            border: none;
            background: transparent;
            color: var(--gray-500);
            font-size: 0.8rem;
            font-weight: 500;
            border-radius: var(--radius-sm);
            cursor: pointer;
            white-space: nowrap;
            transition: var(--transition);
        }

        .tab.active {
            background: var(--white);
            color: var(--primary);
            box-shadow: var(--shadow-sm);
        }

        /* ==========================================
           EXPENSE CHIP
           ========================================== */
        .expense-chip {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-xs);
            padding: var(--spacing-xs) var(--spacing-sm);
            background: var(--gray-100);
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            color: var(--gray-600);
        }

        .expense-chip.paid {
            background: var(--success-light);
            color: var(--success);
        }

        .expense-chip.pending {
            background: var(--danger-light);
            color: var(--danger);
        }

        .expense-chip.due-soon {
            background: var(--warning-light);
            color: var(--warning);
            animation: pulse-warning 1.5s infinite;
        }

        @keyframes pulse-warning {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        /* ==========================================
           MODAL
           ========================================== */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .modal-overlay.open {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--white);
            width: 100%;
            max-height: 90vh;
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
            transform: translateY(100%);
            transition: transform 0.3s ease;
            overflow-y: auto;
        }

        .modal-overlay.open .modal {
            transform: translateY(0);
        }

        .modal-header {
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--gray-100);
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            background: var(--white);
        }

        .modal-title {
            font-size: 1rem;
            font-weight: 600;
        }

        .modal-close {
            width: 32px;
            height: 32px;
            border: none;
            background: var(--gray-100);
            border-radius: var(--radius-full);
            font-size: 1.25rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-body {
            padding: var(--spacing-md);
        }

        /* ==========================================
           QUICK ACTIONS (FAB)
           ========================================== */
        .fab {
            position: fixed;
            right: var(--spacing-md);
            bottom: 80px;
            width: 56px;
            height: 56px;
            border-radius: var(--radius-full);
            background: var(--gradient-primary);
            color: var(--white);
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            z-index: 50;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .fab:hover {
            transform: scale(1.1);
        }

        /* ==========================================
           EMPTY STATE
           ========================================== */
        .empty-state {
            padding: var(--spacing-xl);
            text-align: center;
            color: var(--gray-400);
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: var(--spacing-md);
        }

        .empty-state-text {
            font-size: 0.875rem;
        }

        /* ==========================================
           TOOLTIP
           ========================================== */
        .tooltip {
            position: relative;
        }

        .tooltip-text {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            padding: var(--spacing-sm) var(--spacing-md);
            background: var(--gray-800);
            color: var(--white);
            font-size: 0.75rem;
            border-radius: var(--radius-sm);
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            z-index: 100;
        }

        .tooltip:hover .tooltip-text {
            opacity: 1;
            visibility: visible;
        }

        /* ==========================================
           BADGE
           ========================================== */
        .badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 20px;
            height: 20px;
            padding: 0 var(--spacing-xs);
            background: var(--danger);
            color: var(--white);
            font-size: 0.7rem;
            font-weight: 600;
            border-radius: var(--radius-full);
        }

        /* ==========================================
           PAGES / SCREENS
           ========================================== */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* ==========================================
           LOADING
           ========================================== */
        .loading-overlay {
            position: fixed;
            inset: 0;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3000;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--gray-200);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ==========================================
           TOAST NOTIFICATIONS
           ========================================== */
        .toast-container {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 2500;
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
            width: calc(100% - 32px);
            max-width: 400px;
        }

        .toast {
            background: var(--white);
            padding: var(--spacing-md);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .toast.success { border-left: 4px solid var(--success); }
        .toast.warning { border-left: 4px solid var(--warning); }
        .toast.danger { border-left: 4px solid var(--danger); }

        /* ==========================================
           DESKTOP STYLES
           ========================================== */
        @media (min-width: 768px) {
            .sidebar {
                position: fixed;
                left: 0;
                max-width: var(--sidebar-width);
            }

            .sidebar-overlay {
                display: none;
            }

            .header-mobile {
                display: none;
            }

            .bottom-nav {
                display: none;
            }

            .main {
                margin-left: var(--sidebar-width);
                padding-bottom: 0;
            }

            .content {
                padding: var(--spacing-xl);
                max-width: 1200px;
                margin: 0 auto;
            }

            .hero-metrics {
                grid-template-columns: repeat(4, 1fr);
            }

            .week-summary {
                grid-template-columns: repeat(4, 1fr);
            }

            .fab {
                bottom: var(--spacing-lg);
            }

            .modal {
                max-width: 500px;
                border-radius: var(--radius-lg);
                margin: auto;
            }

            .modal-overlay {
                align-items: center;
            }

            .dashboard-grid {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: var(--spacing-md);
            }

            .dashboard-grid .card {
                margin-bottom: 0;
            }

            .dashboard-grid .card.full-width {
                grid-column: 1 / -1;
            }
        }

        /* ==========================================
           UTILITIES
           ========================================== */
        .hidden { display: none !important; }
        .text-center { text-align: center; }
        .text-success { color: var(--success); }
        .text-danger { color: var(--danger); }
        .text-warning { color: var(--warning); }
        .text-muted { color: var(--gray-400); }
        .font-bold { font-weight: 700; }
        .mt-md { margin-top: var(--spacing-md); }
        .mb-md { margin-bottom: var(--spacing-md); }
    </style>
</head>
<body>
    <!-- Loading -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <div class="app">
        <!-- Sidebar Overlay -->
        <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h1>üí∞ FinTech</h1>
            </div>
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Visao Geral</div>
                    <div class="nav-item active" onclick="navigateTo('home')">
                        <span class="icon">üè†</span>
                        <span>Dashboard</span>
                    </div>
                    <div class="nav-item" onclick="navigateTo('semanal')">
                        <span class="icon">üìÖ</span>
                        <span>Controle Semanal</span>
                    </div>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Negocios</div>
                    <div class="nav-item" onclick="switchModule('chinelos')">
                        <span class="icon">ü©¥</span>
                        <span>Chinelos</span>
                    </div>
                    <div class="nav-item" onclick="switchModule('aquitio')">
                        <span class="icon">üöó</span>
                        <span>Aquitio</span>
                    </div>
                    <div class="nav-item" onclick="switchModule('pessoal')">
                        <span class="icon">üë§</span>
                        <span>Finan√ßas Pessoais</span>
                    </div>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Acoes</div>
                    <div class="nav-item" onclick="openModal('entrada')">
                        <span class="icon">‚ûï</span>
                        <span>Nova Entrada</span>
                    </div>
                    <div class="nav-item" onclick="openModal('despesa')">
                        <span class="icon">‚ûñ</span>
                        <span>Nova Despesa</span>
                    </div>
                    <div class="nav-item" onclick="navigateTo('simulacao')">
                        <span class="icon">üîÆ</span>
                        <span>Simula√ß√µes</span>
                    </div>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main">
            <!-- Header Mobile -->
            <header class="header-mobile">
                <button class="menu-toggle" onclick="toggleSidebar()">‚ò∞</button>
                <h1 id="headerTitle">Dashboard</h1>
                <button class="menu-toggle" onclick="openModal('entrada')">+</button>
            </header>

            <!-- Content -->
            <div class="content">
                <!-- ========== HOME PAGE ========== -->
                <div class="page active" id="page-home">
                    <!-- Alerta Container -->
                    <div id="alertContainer"></div>

                    <!-- Onboarding -->
                    <div class="onboarding" id="onboarding">
                        <div class="onboarding-title">
                            <span>üéØ</span>
                            <span>O que fazer agora?</span>
                        </div>
                        <div class="onboarding-text">
                            Siga estes passos para come√ßar a controlar suas finan√ßas:
                        </div>
                        <div class="onboarding-steps">
                            <div class="onboarding-step" id="step1">
                                <span class="step-number">1</span>
                                <span>Registre sua primeira venda</span>
                            </div>
                            <div class="onboarding-step" id="step2">
                                <span class="step-number">2</span>
                                <span>Confira suas despesas fixas</span>
                            </div>
                            <div class="onboarding-step" id="step3">
                                <span class="step-number">3</span>
                                <span>Veja sua proje√ß√£o de capital</span>
                            </div>
                        </div>
                    </div>

                    <!-- Hero Card - Capital de Giro -->
                    <div class="hero-card" id="heroCard">
                        <div class="hero-label">Capital de Giro Dispon√≠vel</div>
                        <div class="hero-value" id="capitalDisponivel">R$ 0,00</div>
                        <div class="hero-metrics">
                            <div class="hero-metric">
                                <div class="hero-metric-label">Reserva (10%)</div>
                                <div class="hero-metric-value" id="reservaAcumulada">R$ 0,00</div>
                            </div>
                            <div class="hero-metric">
                                <div class="hero-metric-label">Comprometido</div>
                                <div class="hero-metric-value" id="totalComprometido">R$ 0,00</div>
                            </div>
                            <div class="hero-metric">
                                <div class="hero-metric-label">Saldo Projetado</div>
                                <div class="hero-metric-value" id="saldoProjetado">R$ 0,00</div>
                            </div>
                            <div class="hero-metric">
                                <div class="hero-metric-label">Receita do M√™s</div>
                                <div class="hero-metric-value" id="receitaMensal">R$ 0,00</div>
                            </div>
                        </div>
                    </div>

                    <!-- Tabs de Per√≠odo -->
                    <div class="tabs">
                        <button class="tab" data-period="day">Hoje</button>
                        <button class="tab active" data-period="week">Semana</button>
                        <button class="tab" data-period="month">M√™s</button>
                        <button class="tab" data-period="year">Ano</button>
                    </div>

                    <!-- √öltimas Transa√ß√µes -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <span>üìä</span>
                                <span>√öltimas Transa√ß√µes</span>
                            </h3>
                            <button class="btn btn-sm btn-outline" onclick="navigateTo('historico')">Ver todas</button>
                        </div>
                        <div class="card-body">
                            <div class="transaction-list" id="transactionList">
                                <div class="empty-state">
                                    <div class="empty-state-icon">üìù</div>
                                    <div class="empty-state-text">Nenhuma transa√ß√£o registrada.<br>Adicione sua primeira entrada!</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Despesas Fixas -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <span>üìÖ</span>
                                <span>Despesas Fixas do M√™s</span>
                            </h3>
                        </div>
                        <div class="card-body">
                            <div class="transaction-list" id="fixedExpensesList">
                                <!-- Preenchido via JS -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ========== SEMANAL PAGE ========== -->
                <div class="page" id="page-semanal">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <span>üìÖ</span>
                                <span>Controle Semanal</span>
                            </h3>
                        </div>
                        <div class="card-body">
                            <div class="week-summary">
                                <div class="week-stat">
                                    <div class="week-stat-label">Caixa Inicial</div>
                                    <div class="week-stat-value" id="weekCaixaInicial">R$ 0,00</div>
                                </div>
                                <div class="week-stat">
                                    <div class="week-stat-label">Compras</div>
                                    <div class="week-stat-value expense" id="weekCompras">R$ 0,00</div>
                                </div>
                                <div class="week-stat">
                                    <div class="week-stat-label">Vendas</div>
                                    <div class="week-stat-value income" id="weekVendas">R$ 0,00</div>
                                </div>
                                <div class="week-stat">
                                    <div class="week-stat-label">Saldo Final</div>
                                    <div class="week-stat-value" id="weekSaldoFinal">R$ 0,00</div>
                                </div>
                            </div>

                            <h4 style="margin-bottom: var(--spacing-md);">Distribui√ß√£o Autom√°tica</h4>
                            <div class="distribution-bar">
                                <div class="distribution-segment" style="width: 10%; background: var(--primary);"></div>
                                <div class="distribution-segment" style="width: 70%; background: var(--success);"></div>
                                <div class="distribution-segment" style="width: 20%; background: var(--warning);"></div>
                            </div>
                            <div class="distribution-legend">
                                <div class="legend-item">
                                    <div class="legend-color" style="background: var(--primary);"></div>
                                    <span>Reserva 10%: <strong id="weekReserva">R$ 0</strong></span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-color" style="background: var(--success);"></div>
                                    <span>Reinvestimento 70%: <strong id="weekReinvest">R$ 0</strong></span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-color" style="background: var(--warning);"></div>
                                    <span>Contas 20%: <strong id="weekContas">R$ 0</strong></span>
                                </div>
                            </div>

                            <div class="alert alert-success mt-md" id="weekHealthy" style="display: none;">
                                ‚úÖ Semana financeiramente saud√°vel! Voc√™ est√° no caminho certo.
                            </div>
                            <div class="alert alert-warning mt-md" id="weekWarning" style="display: none;">
                                ‚ö†Ô∏è Aten√ß√£o: Suas vendas n√£o cobriram as despesas da semana.
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ========== SIMULACAO PAGE ========== -->
                <div class="page" id="page-simulacao">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <span>üîÆ</span>
                                <span>Proje√ß√£o at√© Dia 8</span>
                            </h3>
                        </div>
                        <div class="card-body">
                            <p class="text-muted mb-md">Calcule quanto voc√™ precisa faturar at√© o dia 8 para pagar todas as contas.</p>
                            <button class="btn btn-primary btn-block" onclick="simularDia8()">Calcular Proje√ß√£o</button>
                            <div id="resultadoDia8" class="mt-md"></div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <span>üí∞</span>
                                <span>Simular Compra</span>
                            </h3>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label class="form-label">Valor da Compra</label>
                                <div class="input-money">
                                    <input type="number" class="form-input" id="simCompraValor" placeholder="0,00" step="0.01">
                                </div>
                            </div>
                            <button class="btn btn-primary btn-block" onclick="simularCompra()">Simular Impacto</button>
                            <div id="resultadoCompra" class="mt-md"></div>
                        </div>
                    </div>
                </div>

                <!-- ========== HISTORICO PAGE ========== -->
                <div class="page" id="page-historico">
                    <div class="tabs">
                        <button class="tab active" data-filter="all">Todas</button>
                        <button class="tab" data-filter="income">Entradas</button>
                        <button class="tab" data-filter="expense">Despesas</button>
                    </div>
                    <div class="card">
                        <div class="card-body">
                            <div class="transaction-list" id="historicoList">
                                <!-- Preenchido via JS -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Bottom Navigation Mobile -->
    <nav class="bottom-nav">
        <div class="bottom-nav-item active" onclick="navigateTo('home')">
            <span class="icon">üè†</span>
            <span>Home</span>
        </div>
        <div class="bottom-nav-item" onclick="navigateTo('semanal')">
            <span class="icon">üìÖ</span>
            <span>Semanal</span>
        </div>
        <div class="bottom-nav-item" onclick="openModal('entrada')">
            <span class="icon" style="font-size: 1.5rem;">‚ûï</span>
            <span>Adicionar</span>
        </div>
        <div class="bottom-nav-item" onclick="navigateTo('simulacao')">
            <span class="icon">üîÆ</span>
            <span>Proje√ß√µes</span>
        </div>
        <div class="bottom-nav-item" onclick="navigateTo('historico')">
            <span class="icon">üìä</span>
            <span>Hist√≥rico</span>
        </div>
    </nav>

    <!-- FAB Button -->
    <button class="fab" onclick="openModal('entrada')" title="Nova Entrada">+</button>

    <!-- Modal: Nova Entrada -->
    <div class="modal-overlay" id="modalEntrada">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">üíµ Nova Entrada</h3>
                <button class="modal-close" onclick="closeModal('entrada')">√ó</button>
            </div>
            <div class="modal-body">
                <form id="formEntrada" onsubmit="adicionarEntrada(event)">
                    <div class="form-group">
                        <label class="form-label">Data</label>
                        <input type="date" class="form-input" id="entradaData" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Descri√ß√£o</label>
                        <input type="text" class="form-input" id="entradaOrigem" placeholder="Ex: Venda 5 pares de chinelo" required>
                        <div class="form-hint">Descreva de onde veio esse dinheiro</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Valor Total (R$)</label>
                        <input type="number" class="form-input" id="entradaValor" placeholder="0,00" step="0.01" min="0" required>
                        <div class="form-hint">10% ser√° automaticamente reservado</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Tipo</label>
                        <select class="form-select" id="entradaTipo" required>
                            <option value="mercadoria">ü©¥ Mercadoria (chinelos)</option>
                            <option value="servico">üöó Servi√ßo (mobilidade)</option>
                            <option value="outro">üì¶ Outro</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-success btn-block">‚úÖ Registrar Entrada</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal: Nova Despesa -->
    <div class="modal-overlay" id="modalDespesa">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">üí∏ Nova Despesa</h3>
                <button class="modal-close" onclick="closeModal('despesa')">√ó</button>
            </div>
            <div class="modal-body">
                <form id="formDespesa" onsubmit="adicionarDespesa(event)">
                    <div class="form-group">
                        <label class="form-label">Data</label>
                        <input type="date" class="form-input" id="despesaData" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Tipo</label>
                        <select class="form-select" id="despesaTipo" required>
                            <option value="combustivel">‚õΩ Combust√≠vel</option>
                            <option value="mercadoria">üì¶ Compra de Mercadoria</option>
                            <option value="frete">üöö Frete</option>
                            <option value="manutencao">üîß Manuten√ß√£o</option>
                            <option value="emprestimo">üí≥ Empr√©stimo</option>
                            <option value="outro">üìù Outro</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Descri√ß√£o</label>
                        <input type="text" class="form-input" id="despesaDescricao" placeholder="Ex: Abastecimento completo" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Valor (R$)</label>
                        <input type="number" class="form-input" id="despesaValor" placeholder="0,00" step="0.01" min="0" required>
                    </div>
                    <button type="submit" class="btn btn-danger btn-block">üí∏ Registrar Despesa</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // ==========================================
        // CONFIGURA√á√ïES GLOBAIS
        // ==========================================
        const CONFIG = {
            API_URL: '/api/fintech/data',
            RESERVA_PERCENTUAL: 0.10,      // 10% para reserva
            REINVEST_PERCENTUAL: 0.70,     // 70% para reinvestimento
            CONTAS_PERCENTUAL: 0.20,       // 20% para contas
            ALERTA_MINIMO: 1000,           // R$ 1.000 m√≠nimo
            STORAGE_KEY: 'fintech_data',   // localStorage key
            CURRENT_MODULE: 'chinelos'     // M√≥dulo ativo
        };

        // ==========================================
        // ESTADO DA APLICA√á√ÉO
        // ==========================================
        let state = {
            entradas: [],
            despesasFixas: [
                { id: 1, descricao: 'Carro', valor: 1650, vencimento: 8, pago: false },
                { id: 2, descricao: 'Internet', valor: 110, vencimento: 5, pago: false },
                { id: 3, descricao: 'Energia', valor: 300, vencimento: 20, pago: false },
                { id: 4, descricao: '√Ågua', valor: 80, vencimento: 20, pago: false },
                { id: 5, descricao: 'Alimenta√ß√£o', valor: 800, vencimento: 15, pago: false }
            ],
            despesasVariaveis: [],
            capitalDisponivel: 0,
            reservaAcumulada: 0,
            modulo: 'chinelos'
        };

        // ==========================================
        // INICIALIZA√á√ÉO
        // ==========================================
        document.addEventListener('DOMContentLoaded', async () => {
            // Definir data de hoje
            const hoje = new Date().toISOString().split('T')[0];
            document.getElementById('entradaData').value = hoje;
            document.getElementById('despesaData').value = hoje;

            // Carregar dados
            await carregarDados();

            // Renderizar interface
            renderizar();

            // Esconder loading
            setTimeout(() => {
                document.getElementById('loadingOverlay').style.display = 'none';
            }, 500);

            // Event listeners para tabs
            document.querySelectorAll('.tabs .tab').forEach(tab => {
                tab.addEventListener('click', (e) => {
                    const tabs = e.target.closest('.tabs');
                    tabs.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    e.target.classList.add('active');
                    renderizar();
                });
            });
        });

        // ==========================================
        // PERSIST√äNCIA - API + LOCALSTORAGE
        // ==========================================
        async function carregarDados() {
            try {
                // Tentar carregar da API primeiro
                const response = await fetch(CONFIG.API_URL);
                if (response.ok) {
                    const result = await response.json();
                    // CORRE√á√ÉO DO BUG: usar result.data, n√£o result diretamente
                    if (result.success && result.data) {
                        // Mesclar dados, mantendo despesas fixas padr√£o se n√£o existirem
                        state = {
                            ...state,
                            entradas: result.data.entradas || [],
                            despesasVariaveis: result.data.despesasVariaveis || [],
                            capitalDisponivel: result.data.capitalDisponivel || 0,
                            reservaAcumulada: result.data.reservaAcumulada || 0,
                            despesasFixas: result.data.despesasFixas?.length > 0
                                ? result.data.despesasFixas
                                : state.despesasFixas
                        };
                        // Salvar no localStorage como backup
                        salvarLocalStorage();
                        console.log('‚úÖ Dados carregados do MongoDB');
                        return;
                    }
                }
            } catch (error) {
                console.log('‚ö†Ô∏è Erro ao carregar da API, tentando localStorage');
            }

            // Fallback para localStorage
            const localData = localStorage.getItem(CONFIG.STORAGE_KEY);
            if (localData) {
                try {
                    const parsed = JSON.parse(localData);
                    state = { ...state, ...parsed };
                    console.log('‚úÖ Dados carregados do localStorage');
                } catch (e) {
                    console.log('‚ö†Ô∏è Erro ao parsear localStorage');
                }
            }
        }

        async function salvarDados() {
            // Salvar no localStorage imediatamente (backup)
            salvarLocalStorage();

            // Salvar na API
            try {
                const response = await fetch(CONFIG.API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(state)
                });

                if (response.ok) {
                    console.log('‚úÖ Dados salvos no MongoDB');
                } else {
                    console.log('‚ö†Ô∏è Erro ao salvar na API');
                }
            } catch (error) {
                console.log('‚ö†Ô∏è Offline - dados salvos apenas localmente');
            }
        }

        function salvarLocalStorage() {
            localStorage.setItem(CONFIG.STORAGE_KEY, JSON.stringify(state));
        }

        // ==========================================
        // NAVEGA√á√ÉO
        // ==========================================
        function navigateTo(page) {
            // Esconder todas as p√°ginas
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));

            // Mostrar p√°gina selecionada
            const pageEl = document.getElementById(`page-${page}`);
            if (pageEl) {
                pageEl.classList.add('active');
            }

            // Atualizar navega√ß√£o
            document.querySelectorAll('.nav-item, .bottom-nav-item').forEach(item => {
                item.classList.remove('active');
            });

            // Atualizar t√≠tulo
            const titles = {
                home: 'Dashboard',
                semanal: 'Controle Semanal',
                simulacao: 'Simula√ß√µes',
                historico: 'Hist√≥rico'
            };
            document.getElementById('headerTitle').textContent = titles[page] || 'FinTech';

            // Fechar sidebar no mobile
            toggleSidebar(false);

            // Renderizar p√°gina espec√≠fica
            if (page === 'semanal') renderizarSemanal();
            if (page === 'historico') renderizarHistorico();
        }

        function toggleSidebar(forceState) {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');

            const isOpen = typeof forceState === 'boolean' ? forceState : !sidebar.classList.contains('open');

            sidebar.classList.toggle('open', isOpen);
            overlay.classList.toggle('visible', isOpen);
        }

        function switchModule(modulo) {
            CONFIG.CURRENT_MODULE = modulo;
            state.modulo = modulo;
            showToast(`M√≥dulo "${modulo}" selecionado`, 'success');
            toggleSidebar(false);
            renderizar();
        }

        // ==========================================
        // MODAIS
        // ==========================================
        function openModal(type) {
            const modal = document.getElementById(`modal${type.charAt(0).toUpperCase() + type.slice(1)}`);
            if (modal) {
                modal.classList.add('open');
            }
            toggleSidebar(false);
        }

        function closeModal(type) {
            const modal = document.getElementById(`modal${type.charAt(0).toUpperCase() + type.slice(1)}`);
            if (modal) {
                modal.classList.remove('open');
            }
        }

        // ==========================================
        // ENTRADAS
        // ==========================================
        async function adicionarEntrada(e) {
            e.preventDefault();

            const valorBruto = parseFloat(document.getElementById('entradaValor').value);
            const reserva = valorBruto * CONFIG.RESERVA_PERCENTUAL;
            const capital = valorBruto - reserva;

            const entrada = {
                id: Date.now(),
                data: document.getElementById('entradaData').value,
                origem: document.getElementById('entradaOrigem').value,
                tipo: document.getElementById('entradaTipo').value,
                valorBruto,
                capital,
                reserva,
                modulo: CONFIG.CURRENT_MODULE
            };

            state.entradas.push(entrada);
            state.capitalDisponivel += capital;
            state.reservaAcumulada += reserva;

            await salvarDados();
            renderizar();

            // Limpar e fechar
            e.target.reset();
            document.getElementById('entradaData').value = new Date().toISOString().split('T')[0];
            closeModal('entrada');

            showToast(`‚úÖ +${formatarMoeda(capital)} no capital | +${formatarMoeda(reserva)} na reserva`, 'success');
        }

        function removerEntrada(id) {
            const entrada = state.entradas.find(e => e.id === id);
            if (!entrada) return;

            if (confirm('Remover esta entrada?')) {
                state.capitalDisponivel -= entrada.capital;
                state.reservaAcumulada -= entrada.reserva;
                state.entradas = state.entradas.filter(e => e.id !== id);

                salvarDados();
                renderizar();
                showToast('Entrada removida', 'warning');
            }
        }

        // ==========================================
        // DESPESAS
        // ==========================================
        async function adicionarDespesa(e) {
            e.preventDefault();

            const despesa = {
                id: Date.now(),
                data: document.getElementById('despesaData').value,
                tipo: document.getElementById('despesaTipo').value,
                descricao: document.getElementById('despesaDescricao').value,
                valor: parseFloat(document.getElementById('despesaValor').value),
                modulo: CONFIG.CURRENT_MODULE
            };

            state.despesasVariaveis.push(despesa);
            state.capitalDisponivel -= despesa.valor;

            await salvarDados();
            renderizar();

            e.target.reset();
            document.getElementById('despesaData').value = new Date().toISOString().split('T')[0];
            closeModal('despesa');

            showToast(`üí∏ -${formatarMoeda(despesa.valor)} do capital`, 'warning');
        }

        function removerDespesa(id) {
            const despesa = state.despesasVariaveis.find(d => d.id === id);
            if (!despesa) return;

            if (confirm('Remover esta despesa?')) {
                state.capitalDisponivel += despesa.valor;
                state.despesasVariaveis = state.despesasVariaveis.filter(d => d.id !== id);

                salvarDados();
                renderizar();
                showToast('Despesa removida', 'success');
            }
        }

        function toggleDespesaFixa(id) {
            const despesa = state.despesasFixas.find(d => d.id === id);
            if (!despesa) return;

            despesa.pago = !despesa.pago;

            if (despesa.pago) {
                state.capitalDisponivel -= despesa.valor;
                showToast(`‚úÖ "${despesa.descricao}" paga`, 'success');
            } else {
                state.capitalDisponivel += despesa.valor;
                showToast(`"${despesa.descricao}" desmarcada`, 'warning');
            }

            salvarDados();
            renderizar();
        }

        // ==========================================
        // C√ÅLCULOS
        // ==========================================
        function calcularTotais() {
            const hoje = new Date();
            const mesAtual = hoje.getMonth();
            const anoAtual = hoje.getFullYear();

            // Receitas do m√™s
            const receitaMensal = state.entradas
                .filter(e => {
                    const d = new Date(e.data);
                    return d.getMonth() === mesAtual && d.getFullYear() === anoAtual;
                })
                .reduce((sum, e) => sum + e.valorBruto, 0);

            // Despesas fixas n√£o pagas
            const totalDespesasFixas = state.despesasFixas
                .filter(d => !d.pago)
                .reduce((sum, d) => sum + d.valor, 0);

            // Despesas vari√°veis do m√™s
            const totalDespesasVariaveis = state.despesasVariaveis
                .filter(d => {
                    const dt = new Date(d.data);
                    return dt.getMonth() === mesAtual && dt.getFullYear() === anoAtual;
                })
                .reduce((sum, d) => sum + d.valor, 0);

            const totalComprometido = totalDespesasFixas;
            const saldoProjetado = state.capitalDisponivel - totalComprometido;

            return {
                receitaMensal,
                totalDespesasFixas,
                totalDespesasVariaveis,
                totalComprometido,
                saldoProjetado
            };
        }

        // ==========================================
        // SIMULA√á√ïES
        // ==========================================
        function simularDia8() {
            const hoje = new Date();
            const dia8 = 8;

            const despesasAteDia8 = state.despesasFixas
                .filter(d => !d.pago && d.vencimento <= dia8)
                .reduce((sum, d) => sum + d.valor, 0);

            const necessario = despesasAteDia8 - state.capitalDisponivel;
            const necessarioComMargem = necessario + CONFIG.ALERTA_MINIMO;

            const resultado = document.getElementById('resultadoDia8');

            if (necessario > 0) {
                resultado.innerHTML = `
                    <div class="alert alert-danger">
                        <div>
                            <strong>‚ùå Falta: ${formatarMoeda(necessario)}</strong><br>
                            <small>Com margem de seguran√ßa: ${formatarMoeda(necessarioComMargem)}</small>
                        </div>
                    </div>
                    <div class="text-muted" style="font-size: 0.875rem;">
                        Capital atual: ${formatarMoeda(state.capitalDisponivel)}<br>
                        Despesas at√© dia 8: ${formatarMoeda(despesasAteDia8)}
                    </div>
                `;
            } else {
                resultado.innerHTML = `
                    <div class="alert alert-success">
                        <div>
                            <strong>‚úÖ Voc√™ tem capital suficiente!</strong><br>
                            <small>Sobra: ${formatarMoeda(Math.abs(necessario))}</small>
                        </div>
                    </div>
                `;
            }
        }

        function simularCompra() {
            const valor = parseFloat(document.getElementById('simCompraValor').value) || 0;
            if (valor === 0) {
                showToast('Informe o valor da compra', 'warning');
                return;
            }

            const capitalApos = state.capitalDisponivel - valor;
            const totais = calcularTotais();
            const saldoProjetado = capitalApos - totais.totalComprometido;

            const resultado = document.getElementById('resultadoCompra');
            let alertClass = 'success';
            let mensagem = '‚úÖ COMPRA VI√ÅVEL';

            if (saldoProjetado < 0) {
                alertClass = 'danger';
                mensagem = '‚ùå COMPRA INVI√ÅVEL';
            } else if (saldoProjetado < CONFIG.ALERTA_MINIMO) {
                alertClass = 'warning';
                mensagem = '‚ö†Ô∏è COMPRA ARRISCADA';
            }

            resultado.innerHTML = `
                <div class="alert alert-${alertClass}">
                    <strong>${mensagem}</strong>
                </div>
                <div class="text-muted" style="font-size: 0.875rem;">
                    Capital ap√≥s compra: ${formatarMoeda(capitalApos)}<br>
                    Contas a pagar: ${formatarMoeda(totais.totalComprometido)}<br>
                    <strong>Saldo projetado: ${formatarMoeda(saldoProjetado)}</strong>
                </div>
            `;
        }

        // ==========================================
        // RENDERIZA√á√ÉO
        // ==========================================
        function renderizar() {
            const totais = calcularTotais();

            // Hero Card
            document.getElementById('capitalDisponivel').textContent = formatarMoeda(state.capitalDisponivel);
            document.getElementById('reservaAcumulada').textContent = formatarMoeda(state.reservaAcumulada);
            document.getElementById('totalComprometido').textContent = formatarMoeda(totais.totalComprometido);
            document.getElementById('saldoProjetado').textContent = formatarMoeda(totais.saldoProjetado);
            document.getElementById('receitaMensal').textContent = formatarMoeda(totais.receitaMensal);

            // Status do Hero Card
            const heroCard = document.getElementById('heroCard');
            heroCard.className = 'hero-card';
            if (totais.saldoProjetado < 0) {
                heroCard.classList.add('danger');
            } else if (totais.saldoProjetado < CONFIG.ALERTA_MINIMO) {
                heroCard.classList.add('warning');
            } else if (state.capitalDisponivel > 0) {
                heroCard.classList.add('success');
            }

            // Alertas
            renderizarAlertas(totais);

            // Transa√ß√µes recentes
            renderizarTransacoes();

            // Despesas fixas
            renderizarDespesasFixas();

            // Onboarding
            atualizarOnboarding();
        }

        function renderizarAlertas(totais) {
            const container = document.getElementById('alertContainer');
            container.innerHTML = '';

            if (totais.saldoProjetado < CONFIG.ALERTA_MINIMO) {
                container.innerHTML += `
                    <div class="alert alert-danger">
                        üö® <strong>RISCO DE CAPITAL!</strong> Saldo projetado: ${formatarMoeda(totais.saldoProjetado)}
                    </div>
                `;
            }

            // Alertas de vencimento
            const hoje = new Date().getDate();
            state.despesasFixas.forEach(d => {
                if (!d.pago) {
                    const dias = d.vencimento - hoje;
                    if (dias >= 0 && dias <= 3) {
                        container.innerHTML += `
                            <div class="alert alert-warning">
                                ‚è∞ "${d.descricao}" vence em ${dias} dia(s) - ${formatarMoeda(d.valor)}
                            </div>
                        `;
                    }
                }
            });
        }

        function renderizarTransacoes() {
            const container = document.getElementById('transactionList');

            // Combinar entradas e despesas
            const transacoes = [
                ...state.entradas.map(e => ({ ...e, isEntrada: true })),
                ...state.despesasVariaveis.map(d => ({ ...d, isEntrada: false }))
            ].sort((a, b) => new Date(b.data) - new Date(a.data)).slice(0, 5);

            if (transacoes.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìù</div>
                        <div class="empty-state-text">Nenhuma transa√ß√£o registrada.<br>Adicione sua primeira entrada!</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = transacoes.map(t => {
                const isEntrada = t.isEntrada;
                const iconClass = isEntrada ? 'income' : (t.tipo === 'combustivel' ? 'fuel' : 'expense');
                const emoji = isEntrada ? 'üíµ' : (t.tipo === 'combustivel' ? '‚õΩ' : 'üí∏');
                const valor = isEntrada ? t.valorBruto : t.valor;
                const descricao = isEntrada ? t.origem : t.descricao;

                return `
                    <div class="transaction-item">
                        <div class="transaction-icon ${iconClass}">${emoji}</div>
                        <div class="transaction-details">
                            <div class="transaction-title">${descricao}</div>
                            <div class="transaction-subtitle">${new Date(t.data).toLocaleDateString('pt-BR')}</div>
                        </div>
                        <div class="transaction-amount ${isEntrada ? 'income' : 'expense'}">
                            ${isEntrada ? '+' : '-'}${formatarMoeda(valor)}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderizarDespesasFixas() {
            const container = document.getElementById('fixedExpensesList');
            const hoje = new Date().getDate();

            container.innerHTML = state.despesasFixas.map(d => {
                const dias = d.vencimento - hoje;
                let statusClass = d.pago ? 'paid' : 'pending';
                let statusText = d.pago ? '‚úÖ Pago' : `Dia ${d.vencimento}`;

                if (!d.pago && dias >= 0 && dias <= 3) {
                    statusClass = 'due-soon';
                    statusText = `‚è∞ ${dias === 0 ? 'Hoje!' : `Em ${dias} dia(s)`}`;
                }

                return `
                    <div class="transaction-item">
                        <div class="transaction-icon ${d.pago ? 'income' : 'expense'}">
                            ${d.pago ? '‚úÖ' : 'üìÖ'}
                        </div>
                        <div class="transaction-details">
                            <div class="transaction-title">${d.descricao}</div>
                            <div class="transaction-subtitle">
                                <span class="expense-chip ${statusClass}">${statusText}</span>
                            </div>
                        </div>
                        <div class="transaction-amount expense">${formatarMoeda(d.valor)}</div>
                        <div class="transaction-actions">
                            <button class="btn btn-sm ${d.pago ? 'btn-outline' : 'btn-success'}"
                                    onclick="toggleDespesaFixa(${d.id})">
                                ${d.pago ? 'Desfazer' : 'Pagar'}
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderizarSemanal() {
            const hoje = new Date();
            const inicioSemana = new Date(hoje);
            inicioSemana.setDate(hoje.getDate() - hoje.getDay());

            // Filtrar transa√ß√µes da semana
            const entradasSemana = state.entradas.filter(e => new Date(e.data) >= inicioSemana);
            const despesasSemana = state.despesasVariaveis.filter(d => new Date(d.data) >= inicioSemana);

            const vendas = entradasSemana.reduce((sum, e) => sum + e.valorBruto, 0);
            const compras = despesasSemana.reduce((sum, d) => sum + d.valor, 0);
            const lucro = vendas - compras;

            // Distribui√ß√£o
            const reserva = lucro > 0 ? lucro * CONFIG.RESERVA_PERCENTUAL : 0;
            const reinvest = lucro > 0 ? lucro * CONFIG.REINVEST_PERCENTUAL : 0;
            const contas = lucro > 0 ? lucro * CONFIG.CONTAS_PERCENTUAL : 0;

            document.getElementById('weekCaixaInicial').textContent = formatarMoeda(state.capitalDisponivel - lucro);
            document.getElementById('weekCompras').textContent = formatarMoeda(compras);
            document.getElementById('weekVendas').textContent = formatarMoeda(vendas);
            document.getElementById('weekSaldoFinal').textContent = formatarMoeda(state.capitalDisponivel);

            document.getElementById('weekReserva').textContent = formatarMoeda(reserva);
            document.getElementById('weekReinvest').textContent = formatarMoeda(reinvest);
            document.getElementById('weekContas').textContent = formatarMoeda(contas);

            // Status da semana
            const weekHealthy = document.getElementById('weekHealthy');
            const weekWarning = document.getElementById('weekWarning');

            if (lucro > 0) {
                weekHealthy.style.display = 'flex';
                weekWarning.style.display = 'none';
            } else if (lucro < 0) {
                weekHealthy.style.display = 'none';
                weekWarning.style.display = 'flex';
            } else {
                weekHealthy.style.display = 'none';
                weekWarning.style.display = 'none';
            }
        }

        function renderizarHistorico() {
            const container = document.getElementById('historicoList');

            const transacoes = [
                ...state.entradas.map(e => ({ ...e, isEntrada: true })),
                ...state.despesasVariaveis.map(d => ({ ...d, isEntrada: false }))
            ].sort((a, b) => new Date(b.data) - new Date(a.data));

            if (transacoes.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìù</div>
                        <div class="empty-state-text">Nenhuma transa√ß√£o no hist√≥rico</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = transacoes.map(t => {
                const isEntrada = t.isEntrada;
                const iconClass = isEntrada ? 'income' : 'expense';
                const emoji = isEntrada ? 'üíµ' : 'üí∏';
                const valor = isEntrada ? t.valorBruto : t.valor;
                const descricao = isEntrada ? t.origem : t.descricao;

                return `
                    <div class="transaction-item">
                        <div class="transaction-icon ${iconClass}">${emoji}</div>
                        <div class="transaction-details">
                            <div class="transaction-title">${descricao}</div>
                            <div class="transaction-subtitle">${new Date(t.data).toLocaleDateString('pt-BR')}</div>
                        </div>
                        <div class="transaction-amount ${isEntrada ? 'income' : 'expense'}">
                            ${isEntrada ? '+' : '-'}${formatarMoeda(valor)}
                        </div>
                        <div class="transaction-actions">
                            <button class="btn btn-sm btn-danger"
                                    onclick="${isEntrada ? `removerEntrada(${t.id})` : `removerDespesa(${t.id})`}">
                                üóëÔ∏è
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function atualizarOnboarding() {
            const onboarding = document.getElementById('onboarding');
            const step1 = document.getElementById('step1');
            const step2 = document.getElementById('step2');
            const step3 = document.getElementById('step3');

            // Step 1: Tem entradas?
            if (state.entradas.length > 0) {
                step1.classList.add('completed');
            }

            // Step 2: Verificou despesas (alguma paga)?
            if (state.despesasFixas.some(d => d.pago)) {
                step2.classList.add('completed');
            }

            // Step 3: Capital > 0
            if (state.capitalDisponivel > 0) {
                step3.classList.add('completed');
            }

            // Esconder onboarding se todos os passos completos
            if (state.entradas.length > 0 && state.capitalDisponivel > 0) {
                onboarding.style.display = 'none';
            }
        }

        // ==========================================
        // UTILIDADES
        // ==========================================
        function formatarMoeda(valor) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(valor || 0);
        }

        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `<span>${message}</span>`;

            container.appendChild(toast);

            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
    </script>
</body>
</html>
